<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Card Fan – Fixed 7 Cards</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
<style>
body {
  margin: 0;
  background: #111;
  font-family: sans-serif;
  overflow: hidden;
  user-select: none;
}
#app {
  height: 100vh;
  width: 100vw;
  position: relative;
}
.fan {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  touch-action: none;
  display: flex;
  justify-content: center;
  align-items: center;
}
.card {
  position: absolute;
  top: 50%;
  left: 0;
  width: 280px;
  height: 400px;
  background: linear-gradient(180deg, #2f2f2f, #1e1e1e);
  border-radius: 18px;
  border: 3px solid rgba(255,255,255,0.35);
  box-shadow: 0 20px 40px rgba(0,0,0,0.6);
  transform-origin: center bottom;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 48px;
  cursor: pointer;
  will-change: transform;
}
</style>
</head>
<body>

<div id="app">
  <div class="fan"
    @pointerdown="onPointerDown"
    @pointermove="onPointerMove"
    @pointerup="onPointerUp"
    @pointercancel="onPointerUp"
  >
    <div v-for="(card,index) in cards"
      :key="card.id"
      class="card"
      :ref="el => cardRefs[index] = el"
      @click="onTap(index)"
    >
      {{ card.label }}
    </div>
  </div>
</div>

<script>
const { createApp, ref, onMounted, nextTick } = Vue

createApp({
setup() {
  // pevně 7 karet
  const cards = ref([
    {id:1,label:'A'},
    {id:2,label:'B'},
    {id:3,label:'C'},
    {id:4,label:'D'},
    {id:5,label:'E'},
    {id:6,label:'F'},
    {id:7,label:'G'}
  ])
  const cardRefs = []
  const currentIndex = ref(3) // střední karta
  let virtualIndex = currentIndex.value
  const isDragging = ref(false)
  const isLocked = ref(false)
  let startX = 0
  let lastTapTime = 0
  const spread = 220
  const rotation = 8
  const DOUBLE_TAP_DELAY = 300

  const screenCenter = () => window.innerWidth/2

  const animatePositions = (animate=true) => {
    cardRefs.forEach((el,index)=>{
      if(!el) return
      const offset = index - virtualIndex
      const abs = Math.abs(offset)
      const xPos = screenCenter() + offset*spread - el.offsetWidth/2
      const yPos = 0
      const scaleTarget = Math.max(0.88, 1.3 - 0.42*Math.abs(offset))
      if(animate){
        gsap.to(el,{
          x:xPos,
          y:yPos,
          rotate:offset*rotation,
          scale:scaleTarget,
          zIndex:100-abs,
          duration:0.25,
          ease:'power2.out'
        })
      } else {
        gsap.set(el,{
          x:xPos,
          y:yPos,
          rotate:offset*rotation,
          scale:scaleTarget,
          zIndex:100-abs
        })
      }
    })
  }

  const onPointerDown = (e)=>{
    if(isLocked.value) return
    isDragging.value=true
    startX=e.clientX
  }

  const onPointerMove = (e)=>{
    if(!isDragging.value||isLocked.value) return
    const dragOffset = e.clientX - startX
    virtualIndex = currentIndex.value - dragOffset/spread
    animatePositions(false)
  }

  const onPointerUp = ()=>{
    if(!isDragging.value||isLocked.value) return
    isDragging.value=false
    currentIndex.value = Math.max(0, Math.min(cards.value.length-1, Math.round(virtualIndex)))
    virtualIndex = currentIndex.value
    animatePositions(true)
  }

  const onTap=(index)=>{
    if(isLocked.value) return
    if(isDragging.value) return
    if(index!==currentIndex.value) return
    const now = Date.now()
    if(now - lastTapTime < DOUBLE_TAP_DELAY) confirmSelection()
    lastTapTime=now
  }

  const confirmSelection = ()=>{
    isLocked.value=true
    const active = cardRefs[currentIndex.value]
    const others = cardRefs.filter((_,i)=>i!==currentIndex.value)
    gsap.timeline()
      .to(active,{scale:1.35,duration:0.3,ease:'power2.out'})
      .to(others,{opacity:0,y:150,stagger:0.05,duration:0.3},'<')
    console.log('Vybraná karta:',cards.value[currentIndex.value])
  }

  onMounted(()=>{
    nextTick(()=>animatePositions(false))
    window.addEventListener('resize',()=>animatePositions(false))
  })

  return {cards,cardRefs,onPointerDown,onPointerMove,onPointerUp,onTap}
}
}).mount('#app')
</script>

</body>
</html>
